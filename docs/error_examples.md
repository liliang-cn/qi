# Qi Language Compiler Error Message Examples
# Qi语言编译器错误消息示例

本文档展示了Qi语言编译器中各种错误消息的示例，帮助开发者理解和调试代码中的问题。所有错误消息都使用中文提供，并包含详细的修复建议和源代码上下文。

## 目录 | Table of Contents

- [语法错误 | Syntax Errors](#语法错误--syntax-errors)
- [语义错误 | Semantic Errors](#语义错误--semantic-errors)
- [运行时错误 | Runtime Errors](#运行时错误--runtime-errors)
- [警告消息 | Warning Messages](#警告消息--warning-messages)
- [错误消息格式 | Error Message Format](#错误消息格式--error-message-format)

## 语法错误 | Syntax Errors

语法错误发生在源代码扫描和解析阶段，当代码的结构不符合Qi语言的语法规则时。这些错误会阻止编译器继续处理代码。

### E008: 缺少分号 | Missing Semicolon

**错误代码**: `E008`
**错误消息**: `语法错误: 缺少分号`

**示例代码:**
```qi
变量 x = 10  // 缺少分号
变量 y = 20
```

**错误消息:**
```
错误[E008]: 语法错误: 缺少分号
  位置: test.qi:1:13
  源代码:
       1 | 变量 x = 10
                 ^
     | ^
     |
建议: 在语句末尾添加分号
```

**修复方法:**
```qi
变量 x = 10;  // 添加分号
变量 y = 20;
```

---

### E009: 缺少右大括号 | Missing Closing Brace

**错误代码**: `E009`
**错误消息**: `语法错误: 缺少闭合的 '}'`

**示例代码:**
```qi
函数 测试函数() {
    打印 "Hello World"
// 缺少右大括号
```

**错误消息:**
```
错误[E009]: 语法错误: 缺少闭合的 '}'
  位置: test.qi:1:1
  源代码:
     --> 文件: test.qi
     |
       1 | 函数 测试函数() {
       2 |     打印 "Hello World"
     | ^
     |
     错误范围: 第1行第1列 到 第2行第1列
     错误文本: "函数 测试函数() {\n    打印 \"Hello World\"\n"
建议: 在代码末尾添加 '}'
```

**修复方法:**
```qi
函数 测试函数() {
    打印 "Hello World"
}  // 添加右大括号
```

---

### E010: 括号不匹配 | Unmatched Brackets

**错误代码**: `E010`
**错误消息**: `语法错误: 括号不匹配: '(' 与 ';' 不匹配`

**示例代码:**
```qi
变量 result = (10 + 20 - 5;  // 应该是 ) 而不是 ;
```

**错误消息:**
```
错误[E010]: 语法错误: 括号不匹配: '(' 与 ';' 不匹配
  位置: test.qi:1:20
  源代码:
     --> 文件: test.qi
     |
       1 | 变量 result = (10 + 20 - 5;
       2 |     打印 "Hello World"
     | ^
     |
     错误范围: 第1行第15列 到 第1行第20列
     错误文本: "10 + 20 - 5"
建议: 检查括号是否正确配对
```

**修复方法:**
```qi
变量 result = (10 + 20 - 5);  // 使用右括号
```

---

### E011: 无效字符 | Invalid Character

**错误代码**: `E011`
**错误消息**: `语法错误: 无效字符: '@'`

**示例代码:**
```qi
变量 x = 10 @ 5;  // @ 是无效字符
```

**错误消息:**
```
错误[E011]: 语法错误: 无效字符: '@'
  位置: test.qi:1:13
  源代码:
     --> 文件: test.qi
     |
       1 | 变量 x = 10 @ 5;
       2 |     打印 "Hello World"
     |                 ^
     | ^
     |
建议: 检查字符是否为有效的Qi语言符号，或者删除不需要的字符
```

**修复方法:**
```qi
变量 x = 10 + 5;  // 使用有效的操作符
```

---

### E012: 未闭合的字符串 | Unclosed String

**错误代码**: `E012`
**错误消息**: `语法错误: 未闭合的字符串字面量`

**示例代码:**
```qi
变量 message = "Hello World;  // 缺少右引号
```

**错误消息:**
```
错误[E012]: 语法错误: 未闭合的字符串字面量
  位置: test.qi:1:14
  源代码:
     --> 文件: test.qi
     |
       1 | 变量 message = "Hello World;
       2 |     打印 "Hello World"
     |              ^
     | ^
     |
建议: 在字符串末尾添加右引号
```

**修复方法:**
```qi
变量 message = "Hello World";  // 添加右引号
```

---

### E013: 无效的转义序列 | Invalid Escape Sequence

**错误代码**: `E013`
**错误消息**: `语法错误: 无效的转义序列: '\x'`

**示例代码:**
```qi
变量 text = "Hello\xWorld";  // \x 是无效的转义序列
```

**错误消息:**
```
错误[E013]: 语法错误: 无效的转义序列: '\x'
  位置: test.qi:1:17
  源代码:
     --> 文件: test.qi
     |
       1 | 变量 text = "Hello\xWorld";
       2 |     打印 "Hello World"
     |                   ^
     | ^
     |
建议: 检查转义序列是否正确
```

**修复方法:**
```qi
变量 text = "Hello\nWorld";  // 使用有效的转义序列
```

---

## 语义错误 | Semantic Errors

语义错误发生在语义分析阶段，当代码的语法正确但含义不合法时。这些错误通常涉及变量使用、类型匹配和函数调用等问题。

### E001: 未定义的变量 | Undefined Variable

**错误代码**: `E001`
**错误消息**: `语义错误: 使用未定义的变量`

**示例代码:**
```qi
变量 x = undefined_var + 5;  // undefined_var 未定义
```

**错误消息:**
```
错误[E001]: 语义错误: 使用未定义的变量: 'undefined_var'
  位置: test.qi:1:13
  源代码:
     --> 文件: test.qi
     |
       1 | 变量 x = undefined_var + 5;
     |             ^^^^^^^^^^^
     |
     错误范围: 第1行第13列 到 第1行第25列
     错误文本: "undefined_var"
建议: 检查变量名 'undefined_var' 是否正确拼写，或者在使用前先声明变量
```

**修复方法:**
```qi
变量 undefined_var = 10;  // 先声明变量
变量 x = undefined_var + 5;
```

---

### E002: 类型不匹配 | Type Mismatch

**错误代码**: `E002`
**错误消息**: `语义错误: 类型不匹配`

**示例代码:**
```qi
变量 a: 整数 = "hello";  // 字符串不能赋值给整数变量
```

**错误消息:**
```
错误[E002]: 语义错误: 类型不匹配: 期望 '整数'，实际 '字符串'
  位置: test.qi:1:7
  源代码:
     --> 文件: test.qi
     |
       1 | 变量 a: 整数 = "hello";
     |       ^^^^^^^^^^^^^^^^^^^
     |
     错误范围: 第1行第7列 到 第1行第22列
     错误文本: "a: 整数 = \"hello\""
建议: 确保赋值的类型与变量声明的类型匹配，或者考虑使用类型转换函数
```

**修复方法:**
```qi
变量 a: 整数 = 42;  // 使用正确类型的值
// 或者
变量 a: 字符串 = "hello";  // 修改变量类型
```

---

### E003: 函数调用参数数量不匹配 | Function Call Argument Count Mismatch

**错误代码**: `E003`
**错误消息**: `语义错误: 函数调用参数数量不匹配`

**示例代码:**
```qi
函数 add(a: 整数, b: 整数): 整数 {
    返回 a + b;
}

变量 result = add(5);  // 缺少一个参数
```

**错误消息:**
```
错误[E003]: 语义错误: 函数调用参数数量不匹配
  位置: test.qi:5:15
  源代码:
     --> 文件: test.qi
     |
       5 | 变量 result = add(5);
     |               ^^^
     |
     错误范围: 第5行第15列 到 第5行第21列
     错误文本: "add(5)"
建议: 函数 'add' 期望 2 个参数，实际提供 1 个。请检查函数签名并添加缺失的参数
```

**修复方法:**
```qi
变量 result = add(5, 10);  // 提供正确数量的参数
```

---

### E004: 数组索引超出范围 | Array Index Out of Bounds

**错误代码**: `E004`
**错误消息**: `语义错误: 数组索引超出范围`

**示例代码:**
```qi
变量 arr = [1, 2, 3];
变量 value = arr[10];  // 索引超出范围
```

**错误消息:**
```
错误[E004]: 语义错误: 数组索引超出范围
  位置: test.qi:2:15
  源代码:
     --> 文件: test.qi
     |
       2 | 变量 value = arr[10];
     |               ^^^^^^^^
     |
     错误范围: 第2行第15列 到 第2行第23列
     错误文本: "arr[10]"
建议: 数组索引 10 超出范围 [0, 2]。请确保索引值在数组长度范围内
```

**修复方法:**
```qi
变量 value = arr[0];  // 使用有效的索引
// 或者添加边界检查
变量 index = 10;
如果 (index >= 0 且 index < arr.长度) {
    变量 value = arr[index];
}
```

---

## 运行时错误 | Runtime Errors

运行时错误发生在程序执行过程中，当程序遇到无法继续执行的情况时。

### R001: 除零错误 | Division by Zero

**错误代码**: `R001`
**错误消息**: `运行时错误: 除零错误`

**示例代码:**
```qi
函数 test_division_by_zero() {
    变量 a = 10;
    变量 b = 0;
    变量 result = a / b;  // 运行时除零错误
    打印 result;
}

test_division_by_zero();
```

**错误消息:**
```
运行时错误 [R001]: 除零错误
  位置: test.qi:4:17
  源代码:
     --> 文件: test.qi
     |
       4 |     变量 result = a / b;
     |                 ^^^^^^
     |
     错误范围: 第4行第17列 到 第4行第22列
     错误文本: "a / b"
建议: 检查除数是否为零，或添加条件检查: 如果 (b != 0) { 变量 result = a / b; }
调用栈:
  -> test_division_by_zero() at test.qi:2
  -> main() at test.qi:7
```

**修复方法:**
```qi
函数 safe_divide(a: 整数, b: 整数): 整数 {
    如果 (b == 0) {
        返回 0;  // 或者抛出异常，或者返回错误码
    }
    返回 a / b;
}

变量 result = safe_divide(10, 0);
```

---

### R002: 数组访问越界 | Array Access Out of Bounds

**错误代码**: `R002`
**错误消息**: `运行时错误: 数组访问越界`

**示例代码:**
```qi
变量 arr = [1, 2, 3];
变量 index = 10;
变量 value = arr[index];  // 运行时越界访问
```

**错误消息:**
```
运行时错误 [R002]: 数组访问越界
  位置: test.qi:3:12
  源代码:
     --> 文件: test.qi
     |
       3 | 变量 value = arr[index];
     |            ^^^^^^^^^^^^
     |
     错误范围: 第3行第12列 到 第3行第25列
     错误文本: "arr[index]"
建议: 数组索引 10 超出范围 [0, 2]。请添加边界检查: 如果 (index >= 0 且 index < arr.长度)
调用栈:
  -> main() at test.qi:1
```

**修复方法:**
```qi
变量 arr = [1, 2, 3];
变量 index = 10;
变量 value = 0;  // 默认值

如果 (index >= 0 且 index < arr.长度) {
    变量 value = arr[index];
} 否则 {
    打印 "警告: 数组索引超出范围";
}
```

---

### R003: 栈溢出 | Stack Overflow

**错误代码**: `R003`
**错误消息**: `运行时错误: 栈溢出`

**示例代码:**
```qi
函数 infinite_recursion(depth: 整数): 整数 {
    打印 "递归深度:", depth;
    返回 infinite_recursion(depth + 1);  // 无限递归
}

变量 result = infinite_recursion(0);
```

**错误消息:**
```
运行时错误 [R003]: 栈溢出 - 可能是由于无限递归
  位置: test.qi:3:12
  源代码:
     --> 文件: test.qi
     |
       3 |     返回 infinite_recursion(depth + 1);
     |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     |
     错误范围: 第3行第12列 到 第3行第44列
     错误文本: "infinite_recursion(depth + 1)"
建议: 检查递归函数是否有正确的终止条件，或者考虑使用迭代代替递归
调用栈:
  -> infinite_recursion(9997) at test.qi:3
  -> infinite_recursion(9996) at test.qi:3
  -> infinite_recursion(9995) at test.qi:3
  ... (更多调用栈)
  -> infinite_recursion(0) at test.qi:5
  -> main() at test.qi:1
```

**修复方法:**
```qi
函数 factorial(n: 整数, acc: 整数 = 1): 整数 {
    如果 (n <= 1) {
        返回 acc;
    }
    返回 factorial(n - 1, n * acc);  // 尾递归优化
}

变量 result = factorial(5);
```

---

## 警告消息 | Warning Messages

警告不会阻止程序执行，但提示可能存在的问题或改进建议。

### W001: 未使用的变量 | Unused Variable

**错误代码**: `W001`
**错误消息**: `警告: 未使用的变量`

**示例代码:**
```qi
变量 unused_var = 42;  // 声明但未使用
打印 "Hello World";
```

**警告消息:**
```
警告 [W001]: 未使用的变量: 'unused_var'
  位置: test.qi:1:1
  源代码:
     --> 文件: test.qi
     |
       1 | 变量 unused_var = 42;
     | ^^^^^^^^^^^^^^^^^^^^^^^
     |
     错误范围: 第1行第1列 到 第1行第20列
     错误文本: "变量 unused_var = 42"
建议: 如果不需要此变量，请删除声明。或者使用变量: 打印 unused_var;
```

**修复方法:**
```qi
// 方法1: 使用变量
变量 used_var = 42;
打印 used_var;

// 方法2: 删除未使用的变量
打印 "Hello World";
```

---

### W002: 隐式类型转换 | Implicit Type Conversion

**错误代码**: `W002`
**错误消息**: `警告: 隐式类型转换`

**示例代码:**
```qi
变量 int_val: 整数 = 42;
变量 float_val: 小数 = int_val;  // 隐式转换
```

**警告消息:**
```
警告 [W002]: 隐式类型转换: 从 '整数' 转换为 '小数'
  位置: test.qi:2:17
  源代码:
     --> 文件: test.qi
     |
       2 | 变量 float_val: 小数 = int_val;
     |                 ^^^^^^^
     |
     错误范围: 第2行第17列 到 第2行第33列
     错误文本: "float_val: 小数 = int_val"
建议: 建议使用显式类型转换: 变量 float_val: 小数 = 转小数(int_val);
```

**修复方法:**
```qi
变量 int_val: 整数 = 42;
变量 float_val: 小数 = 转小数(int_val);  // 显式转换
```

---

### W003: 函数返回值未使用 | Function Return Value Unused

**错误代码**: `W003`
**错误消息**: `警告: 函数返回值未使用`

**示例代码:**
```qi
函数 calculate_sum(a: 整数, b: 整数): 整数 {
    返回 a + b;
}

calculate_sum(5, 10);  // 返回值未使用
打印 "计算完成";
```

**警告消息:**
```
警告 [W003]: 函数返回值未使用
  位置: test.qi:6:1
  源代码:
     --> 文件: test.qi
     |
       6 | calculate_sum(5, 10);
     | ^^^^^^^^^^^^^^^^^^^^^^^^
     |
     错误范围: 第6行第1列 到 第6行第22列
     错误文本: "calculate_sum(5, 10)"
建议: 函数 'calculate_sum' 返回了值但未被使用。请将结果赋值给变量或确认可以忽略返回值
```

**修复方法:**
```qi
函数 calculate_sum(a: 整数, b: 整数): 整数 {
    返回 a + b;
}

变量 result = calculate_sum(5, 10);  // 使用返回值
打印 result;
```

---

### E002: 未终止的字符串字面量

**错误代码**: `E002`
**错误消息**: `词法错误: 未终止的字符串字面量在第 {行} 行第 {列} 列`

**示例**:
```qi
变量 message = "hello world;  // 缺少结束引号
```

**输出**:
```
词法错误: 未终止的字符串字面量在第 1 行第 8 列
```

**建议**: 为字符串添加结束的引号 `"`。

### E003: 无效的数字格式

**错误代码**: `E003`
**错误消息**: `词法错误: 无效的数字格式在第 {行} 行第 {列} 列`

**示例**:
```qi
变量 x = 123.456.789;  // 多个小数点
```

**输出**:
```
词法错误: 无效的数字格式在第 1 行第 10 列
```

**建议**: 检查数字格式，确保只有一个小数点。

## 解析错误

解析错误发生在语法分析阶段，当代码的结构不符合 Qi 语言的语法规则时。

### E101: 期望的分号

**错误代码**: `E101`
**错误消息**: `解析错误: 期望 ';'，找到 '{实际字符}'`

**示例**:
```qi
变量 x = 42
打印 x
```

**输出**:
```
解析错误: 期望 ';'，找到 '打印'
```

**建议**: 在语句末尾添加分号 `;`。

### E102: 未闭合的括号

**错误代码**: `E102`
**错误消息**: `解析错误: 未闭合的括号`

**示例**:
```qi
变量 result = (10 + 5 * 3;  // 缺少右括号
```

**输出**:
```
解析错误: 未闭合的括号
```

**建议**: 添加缺失的右括号 `)`。

### E103: 无效的函数声明

**错误代码**: `E103`
**错误消息**: `解析错误: 无效的函数声明语法`

**示例**:
```qi
函数 bad func() {  // 空格不是有效的函数名
    返回 42;
}
```

**输出**:
```
解析错误: 无效的函数声明语法
```

**建议**: 函数名应该是有效的标识符，不能包含空格。

## 语义错误

语义错误发生在语义分析阶段，当代码的语法正确但含义不合法时。

### E201: 未定义的变量

**错误代码**: `E201`
**错误消息**: `语义错误: 未定义的变量: '{变量名}'`

**示例**:
```qi
变量 x = y + 5;  // y 未定义
```

**输出**:
```
语义错误: 未定义的变量: 'y'
```

**建议**: 确保变量在使用前已经声明。

### E202: 类型不匹配

**错误代码**: `E202`
**错误消息**: `语义错误: 类型不匹配: 期望 '{期望类型}'，实际 '{实际类型}'`

**示例**:
```qi
变量 a : 整数 = "hello";  // 字符串不能赋值给整数变量
```

**输出**:
```
语义错误: 类型不匹配: 期望 '整数'，实际 '字符串'
```

**建议**: 确保赋值的类型与变量声明的类型匹配。

### E203: 函数调用参数数量不匹配

**错误代码**: `E203`
**错误消息**: `语义错误: 函数 '{函数名}' 期望 {期望数量} 个参数，实际提供 {实际数量} 个`

**示例**:
```qi
函数 add(a : 整数, b : 整数) : 整数 {
    返回 a + b;
}
变量 result = add(5);  // 缺少一个参数
```

**输出**:
```
语义错误: 函数 'add' 期望 2 个参数，实际提供 1 个
```

**建议**: 提供正确数量的参数。

### E204: 重复的变量声明

**错误代码**: `E204`
**错误消息**: `语义错误: 变量 '{变量名}' 已经在此作用域中声明`

**示例**:
```qi
变量 x = 10;
变量 x = 20;  // 重复声明
```

**输出**:
```
语义错误: 变量 'x' 已经在此作用域中声明
```

**建议**: 使用不同的变量名或在不同的作用域中声明。

## 运行时错误

运行时错误发生在程序执行过程中，当程序遇到无法继续执行的情况时。

### R301: 除零错误

**错误代码**: `R301`
**错误消息**: `运行时错误: 除零错误`

**示例**:
```qi
变量 a = 10;
变量 b = 0;
变量 result = a / b;  // 除零
```

**输出**:
```
运行时错误: 除零错误
```

**建议**: 检查除数是否为零，或添加条件检查。

### R302: 数组越界访问

**错误代码**: `R302`
**错误消息**: `运行时错误: 数组索引 {索引} 超出范围 [0, {最大索引}]`

**示例**:
```qi
变量 arr = [1, 2, 3];
变量 value = arr[10];  // 越界访问
```

**输出**:
```
运行时错误: 数组索引 10 超出范围 [0, 2]
```

**建议**: 确保数组索引在有效范围内。

### R303: 栈溢出

**错误代码**: `R303`
**错误消息**: `运行时错误: 栈溢出 - 可能是由于无限递归`

**示例**:
```qi
函数 infinite_recursion() {
    返回 infinite_recursion();  // 无限递归
}
```

**输出**:
```
运行时错误: 栈溢出 - 可能是由于无限递归
```

**建议**: 检查递归函数是否有正确的终止条件。

## 错误消息格式

所有错误消息都遵循以下格式：

```
{错误类型}: {错误描述} [{错误代码}]
```

其中：
- **错误类型**: 词法错误、解析错误、语义错误、运行时错误
- **错误描述**: 具体的错误描述
- **错误代码**: 唯一的错误标识符

## 错误恢复建议

对于每个错误，编译器都会提供一些建议来帮助修复问题：

1. **检查拼写**: 确保关键字和标识符拼写正确
2. **检查语法**: 确保语法符合 Qi 语言规范
3. **检查类型**: 确保类型匹配和转换正确
4. **检查作用域**: 确保变量在正确的作用域内使用
5. **检查边界**: 确保数组访问和数学运算在有效范围内

## 调试技巧

1. **从第一个错误开始修复**: 通常后续错误是由前面的错误引起的
2. **查看错误上下文**: 错误消息会显示出错的行号和列号
3. **使用编译器详细模式**: 添加 `-v` 参数获取更多信息
4. **分步编译**: 将大程序分成小部分分别编译测试

## 更多帮助

如果遇到本文档未涵盖的错误，请：

1. 检查 [Qi 语言规范](language_reference.md)
2. 查看 [示例代码](../examples/)
3. 提交 issue 到 [GitHub 仓库](https://github.com/qi-lang/qi-compiler)

---

*本文档随 Qi 编译器版本更新，最后更新: 2025-10-21*