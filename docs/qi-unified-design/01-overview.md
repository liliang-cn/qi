# 设计原则与项目结构

**Qi 语言**：100% 中文关键字的现代编程语言，文件后缀 `.qi`
**设计理念**：中文语法 + Rust 编译器前端 + Rust 运行时 (M:N 调度) + C 平台抽象接口 + LLVM 后端
**总体目标**：提供完全中文的开发体验，同时保持高性能、高并发和底层控制能力，支持编译到 Windows、Linux、macOS 和 WebAssembly。

---

## 设计概述

### 核心设计原则

- **100% 中文关键字**：所有语言关键字均使用中文，无任何英文保留字。
- **统一架构**：Rust 编译器 + Rust 运行时 + C 系统调用 + LLVM 后端。
- **性能优先**：编译到原生机器码，追求零运行时开销。
- **现代特性**：支持 M:N 协程并发 (类似 Goroutine)、错误处理、泛型等。
- **跨平台**：通过 LLVM 和平台抽象层，原生支持 Windows、Linux、macOS 和 WASM (WASI)。
- **开发友好**：提供完整的工具链 (LSP、语法高亮) 和标准库。

### 技术栈

| 组件         | 技术栈                | 作用                                                  |
| :----------- | :-------------------- | :---------------------------------------------------- |
| **词法分析** | Rust + LALRPOP        | Token 解析，支持 UTF-8 中文                           |
| **语法分析** | Rust + LALRPOP        | AST 构建，错误恢复                                    |
| **中间代码** | Rust + inkwell        | LLVM IR 生成                                          |
| **代码优化** | LLVM                  | 标准优化管道                                          |
| **运行时**   | **Rust + C**          | 内存管理、并发调度 (Rust, M:N)、系统调用 (C 抽象接口) |
| **标准库**   | Qi 语言 + C/Rust 绑定 | 基础设施和常用功能                                    |

### 文件命名

- **源文件**：以 `.qi` 作为后缀。
- **包文件**：`包名.qi` 或 `模块名.qi`。
- **配置文件**：`qimod.json`。
- **构建产物**：`.o`、`.ll`、可执行文件。

---

## 项目结构

当前仓库遵循 Rust 标准工作区布局：

```
qi/
├── Cargo.toml              # Rust 工作区配置
├── README.md               # 项目说明
├── build.rs                # 构建脚本 (LALRPOP)
├── src/
│   ├── main.rs             # CLI 入口
│   ├── lib.rs              # 库入口
│   ├── cli/                # 命令行接口
│   ├── lexer/              # 词法分析器
│   ├── parser/             # 语法分析器
│   ├── semantic/           # 语义分析器
│   ├── codegen/            # 代码生成 (LLVM)
│   ├── runtime/            # Rust 运行时
│   │   ├── async_runtime/  # 异步运行时 (M:N)
│   │   ├── memory/         # 内存管理
│   │   ├── io/             # I/O 接口
│   │   └── stdlib/         # 标准库绑定
│   ├── targets/            # 目标平台支持
│   └── utils/              # 工具函数
├── tests/                  # 测试文件
├── examples/               # 示例程序
└── docs/                   # 文档
```
